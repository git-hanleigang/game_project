{"version":3,"sources":["file:///Users/xcyy/Desktop/createrPro/cashSlot/assets/scripts/machine.ts"],"names":["_decorator","Component","Button","Singleton","reelRoll","ccclass","property","machine","singleton","getInstance","buttonSpin","buttonStop","colNum","stopIndex","start","reelColAndRow","length","setMachineScript","node","getChildByName","getComponent","index","rollNode","getReelRoll","scrip","setReelIndex","setBtnState","update","deltaTime","callback","event","costomEventData","button","target","buttonName","name","console","log","startSpin","stopSpin","reelNode","reelScript","beginReel","reelStopFunc","isQuickStop","quickStop","spinBtnState","stopBtnState","interactable"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAwBC,MAAAA,M,OAAAA,M;;AACtCC,MAAAA,S;;AACEC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;yBAGjBO,O,WADZF,OAAO,CAAC,SAAD,C,gBAAR,MACaE,OADb,SAC6BN,SAD7B,CACuC;AAAA;AAAA;AAAA,eAC5BO,SAD4B,GACL;AAAA;AAAA,sCAAUC,WAAV,EADK;AAAA,eAE3BC,UAF2B,GAET,IAFS;AAAA,eAG3BC,UAH2B,GAGT,IAHS;AAAA,eAI5BC,MAJ4B,GAIX,IAJW;AAIL;AAJK,eAK5BC,SAL4B,GAKR,IALQ;AAAA;;AAKF;AACjCC,QAAAA,KAAK,GAAG;AACJ,eAAKF,MAAL,GAAc,KAAKJ,SAAL,CAAeO,aAAf,CAA6BC,MAA3C;AACA,eAAKR,SAAL,CAAeS,gBAAf,CAAgC,IAAhC;AACA,eAAKP,UAAL,GAAkB,KAAKQ,IAAL,CAAUC,cAAV,CAAyB,SAAzB,EAAoCC,YAApC,CAAiDlB,MAAjD,CAAlB;AACA,eAAKS,UAAL,GAAkB,KAAKO,IAAL,CAAUC,cAAV,CAAyB,SAAzB,EAAoCC,YAApC,CAAiDlB,MAAjD,CAAlB,CAJI,CAMJ;;AACA,eAAK,IAAImB,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,KAAKT,MAAjC,EAAyCS,KAAK,EAA9C,EAAkD;AAC9C,gBAAIC,QAAQ,GAAG,KAAKC,WAAL,CAAiBF,KAAjB,CAAf;AACA,gBAAIG,KAAK,GAAGF,QAAQ,CAACF,YAAT;AAAA;AAAA,qCAAZ;AACAI,YAAAA,KAAK,CAACC,YAAN,CAAmBJ,KAAnB;AACH,WAXG,CAaJ;;;AACA,eAAKK,WAAL,CAAiB,IAAjB,EAAuB,KAAvB;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAEDC,QAAAA,QAAQ,CAAEC,KAAF,EAAgBC,eAAhB,EAAyC;AAC7C,cAAIC,MAAM,GAAGF,KAAK,CAACG,MAAnB;AACA,cAAIC,UAAU,GAAGF,MAAM,CAACG,IAAxB;;AACA,cAAID,UAAU,IAAI,SAAlB,EAA4B;AACxBE,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,iBAAKC,SAAL;AACH,WAHD,MAIK,IAAIJ,UAAU,IAAI,SAAlB,EAA4B;AAC7BE,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,iBAAKE,QAAL,CAAc,IAAd;AACH;AACJ;;AAEDhB,QAAAA,WAAW,CAACF,KAAD,EAAe;AACtB,cAAImB,QAAQ,GAAG,KAAKtB,IAAL,CAAUC,cAAV,CAAyB,MAAzB,EAAiCA,cAAjC,CAAgD,UAAQE,KAAxD,CAAf;AACA,iBAAOmB,QAAP;AACH;;AAEDF,QAAAA,SAAS,GAAG;AACR,eAAKzB,SAAL,GAAiB,CAAjB;;AACA,eAAK,IAAIQ,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,KAAKT,MAAjC,EAAyCS,KAAK,EAA9C,EAAiD;AAC7C,gBAAIC,QAAQ,GAAG,KAAKC,WAAL,CAAiBF,KAAjB,CAAf;AACA,gBAAIoB,UAAU,GAAGnB,QAAQ,CAACF,YAAT;AAAA;AAAA,qCAAjB;AACAqB,YAAAA,UAAU,CAACC,SAAX;AACH;;AACD,eAAKhB,WAAL,CAAiB,KAAjB,EAAwB,IAAxB;AACH;;AAEDiB,QAAAA,YAAY,CAACtB,KAAD,EAAe;AACvB,eAAKR,SAAL,GAAiB,KAAKA,SAAL,GAAiBQ,KAAlC;;AACA,cAAI,KAAKR,SAAL,IAAkB,KAAKD,MAA3B,EAAkC;AAC9B,iBAAK2B,QAAL,CAAc,KAAd;AACA,iBAAKb,WAAL,CAAiB,IAAjB,EAAuB,KAAvB;AACH;AACJ;;AAEDa,QAAAA,QAAQ,CAACK,WAAD,EAAsB;AAC1B,eAAK,IAAIvB,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,KAAKT,MAAjC,EAAyCS,KAAK,EAA9C,EAAiD;AAC7C,gBAAIC,QAAQ,GAAG,KAAKC,WAAL,CAAiBF,KAAjB,CAAf;AACA,gBAAIoB,UAAU,GAAGnB,QAAQ,CAACF,YAAT;AAAA;AAAA,qCAAjB;AACAqB,YAAAA,UAAU,CAACI,SAAX,GAAuBD,WAAvB;AACH;;AACD,eAAKlB,WAAL,CAAiB,IAAjB,EAAuB,KAAvB;AACH;;AAEDA,QAAAA,WAAW,CAACoB,YAAD,EAAuBC,YAAvB,EAA4C;AACnD,eAAKrC,UAAL,CAAgBsC,YAAhB,GAA+BF,YAA/B;AACA,eAAKnC,UAAL,CAAgBqC,YAAhB,GAA+BD,YAA/B;AACH;;AA3EkC,O","sourcesContent":["import { _decorator, Component, Event, Node, Button, EventHandler } from 'cc';\nimport Singleton from './Singleton';\nimport { reelRoll } from './reelRoll';\nconst { ccclass, property } = _decorator;\n\n@ccclass('machine')\nexport class machine extends Component {\n    public singleton: Singleton = Singleton.getInstance()\n    private buttonSpin: any = null;\n    private buttonStop: any = null;\n    public colNum: number = null; // 行配置\n    public stopIndex: number = null; // 行停止计数\n    start() {\n        this.colNum = this.singleton.reelColAndRow.length\n        this.singleton.setMachineScript(this)\n        this.buttonSpin = this.node.getChildByName(\"spinBtn\").getComponent(Button)\n        this.buttonStop = this.node.getChildByName(\"stopBtn\").getComponent(Button)\n\n        //设置当前列\n        for (let index = 0; index < this.colNum; index++) {\n            let rollNode = this.getReelRoll(index)\n            let scrip = rollNode.getComponent(reelRoll)\n            scrip.setReelIndex(index)\n        }\n\n        //初始化按钮状态\n        this.setBtnState(true, false)\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    callback (event: Event, costomEventData: string) {\n        let button = event.target as Node;\n        let buttonName = button.name\n        if (buttonName == \"spinBtn\"){\n            console.log(\"开始spin\")\n            this.startSpin()\n        }\n        else if (buttonName == \"stopBtn\"){\n            console.log(\"停止stop\")\n            this.stopSpin(true)\n        }\n    }\n\n    getReelRoll(index: number){\n        let reelNode = this.node.getChildByName(\"Mask\").getChildByName(\"reel_\"+index)\n        return reelNode\n    }\n\n    startSpin() {\n        this.stopIndex = 0\n        for (let index = 0; index < this.colNum; index++){\n            let rollNode = this.getReelRoll(index)\n            let reelScript = rollNode.getComponent(reelRoll)\n            reelScript.beginReel()\n        }\n        this.setBtnState(false, true)\n    }\n\n    reelStopFunc(index: number){\n        this.stopIndex = this.stopIndex + index\n        if (this.stopIndex >= this.colNum){\n            this.stopSpin(false)\n            this.setBtnState(true, false)\n        }\n    }\n\n    stopSpin(isQuickStop: boolean){\n        for (let index = 0; index < this.colNum; index++){\n            let rollNode = this.getReelRoll(index)\n            let reelScript = rollNode.getComponent(reelRoll)\n            reelScript.quickStop = isQuickStop\n        }\n        this.setBtnState(true, false)\n    }\n\n    setBtnState(spinBtnState:boolean, stopBtnState:boolean){\n        this.buttonSpin.interactable = spinBtnState\n        this.buttonStop.interactable = stopBtnState\n    }\n}\n\n"]}